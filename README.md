# Aorta Segmentation (2D + Time)

This repository contains code for **time-resolved 2D aorta segmentation** in **4D flow MRI**, developed for research purposes during my PhD at the **German Heart Center of Charité (DHZC)**.

The code focuses on **training and evaluation** of a deep learning–based segmentation model applied to cross-sectional aortic planes over the cardiac cycle.

---

## Overview

The method targets aorta cross-section segmentation in **2D + time (2D+t)** data derived from 4D flow MRI.  
It was designed and evaluated in a **multi-center setting**, with particular attention to model generalizability across heterogeneous datasets.
Each patient has **multiple cross-sections**, so training, validation, and test splits are performed **patient-wise** to avoid data leakage.

The segmentation model is based on a **Residual U-Net architecture** implemented using **MONAI** and **PyTorch**, and was adapted for time-resolved inputs.

---

## Method

- **Frameworks:** Python, PyTorch, MONAI  
- **Model:** Residual U-Net (MONAI-based, adapted)    
- **Input:** 3D tensor with 4 channels:
  - magnitude
  - velx
  - vely
  - velz
  The 3D dimensions correspond to the **time-resolved 2D cross-section of the aorta** (2D+t).
  
  **Example input shape:** `[4, height, width, time]`  
  - 4 channels: magnitude, velx, vely, velz  
  - `height`, `width`: dimensions of the 2D cross-section  
  - `time`: number of frames in the cardiac cycle 
- **Output:** Binary aorta segmentation masks  

Sliding-window inference is used during evaluation, and post-processing includes thresholding and connected-component filtering.

---

## Repository Contents

The repository includes:
- Training code for the segmentation model  
- Evaluation code with common segmentation metrics (e.g. Dice, Hausdorff distance, ASSD, sensitivity, precision)  
- Data handling and preprocessing utilities  
- Scripts for creating dataset dictionaries for multi-center studies  

The evaluation scripts can also be adapted for inference, provided a trained model is available.

---

## Data Format and Organization

This repository **does not include any imaging data**.

The code expects data to be provided externally in **NIfTI format (`.nii.gz`)**, organized per patient and per cross-section as 2D cross-sectional planes of the aorta over time (2D+t), including:
- `magnitude`
- `velx`
- `vely`
- `velz`
- `mask` (ground truth)

Dataset splits (training / validation / test) are **patient-wise** and defined through JSON dictionaries generated by the provided utilities, enabling flexible multi-center data composition.

---

## Models and Data Availability

Due to data protection and institutional constraints:
- **No patient data is shared**
- **No trained model weights are shared**

This repository provides **code only**, intended to enable reproducibility in principle and methodological transparency.

The model trained on the full multi-center dataset is integrated into the **MEVISFlow research software**.

---

## Research Context and Citation

This work was developed during Chiara Manini's PhD at the **German Heart Center of Charité (DHZC)**.  
If you use this code in academic work, please cite the associated publication:

**Chiara Manini, M. Hüllebrand, L. Walczak, S. Nordmeyer, L. Jarmatz, T. Kühn, H. Stern, C. Meierhofer, A. Harloff, J. Erley, S. Kelle, P. Bannas, R.F. Trauzeddel, J. Schulz-Menger, A. Hennemuth.**  
*Impact of training data composition on the generalizability of CNN aortic cross-section segmentation in 4D Flow MRI.*  
**Journal of Cardiovascular Magnetic Resonance, 26:101081, 2024.**  
DOI: [10.1016/j.jocmr.2024.101081](https://doi.org/10.1016/j.jocmr.2024.101081)


---

## Intended Use

This code is provided for **research and educational purposes only**.  
It is **not intended for clinical use**.

---

## License

This repository is licensed under the **BSD 3-Clause License**.  
The associated publication is distributed under **CC BY 4.0**.  
Use and modification of this code is permitted with proper attribution.
